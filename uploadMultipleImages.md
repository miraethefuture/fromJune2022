# Nov 17 
  
  사진을 첨부하여 업로드하는 기능을 가진 메뉴가 있는데, 현재 iOS 앱은 이미지를 하나씩 선택하고 추가할 수 있다.  
  3장을 추가하고 싶다면 3번을 선택하고 추가하는 일을 반복해야 한다.  
  사용중인 곳에서 여러 장을 한꺼번에 선택해서 올릴 수 있도록 기능 개선을 요청했다.  
  
## UIImagePickerController and PHPickerViewController
  
  소스를 보니 UIImagePickerController를 사용하여 라이브러리에서 이미지를 가져오고 있었다. 기존 소스를 이용할까 싶어 구글링을 해보니 UIImagePickerController로 여러장의 이미지를  
  선택하고 추가하려면 커스텀한 image picker를 사용해야 했다. third party를 사용하고 싶지 않아서 조금 더 구글링을 해보니 iOS 14 부터 애플 API PHPickerViewController를 사용하여  
  다중 이미지 선택/추가를 구현할 수 있다는 것을 발견했다.  
  
## Swift and Objective-C  
  
  현재 회사 앱의 코드는 Objective-C 로 작성되어 있다. 그런데 검색을 해보니 Objective-C 로 작성한 PHPickerViewController 관련 자료가 아주 적었다. 그에 비해 Swift 자료는 꽤 있어서  
  기존 Objective-C 프로젝트에 Swift 파일을 추가해 보기로 했다. 입사 초반에 한 번 시도해보고 싶었는데 당시에는 다른 일정으로 iOS 개발에 대한 시간이 주어지지 않아서 접었었다.  
  현재는 Swift - Objective-C 양쪽에서 다른 쪽의 클래스를 사용할 수 있도록 설정해 두었다. (오늘 이슈가 있었는데 잘 빌드되던 앱이 갑자기 import 부분에서 브릿징 헤더를 찾을 수 없다며 빌드 되지 않았다.)  
  급한 불을 꺼보자 싶어서 import한 부분을 주석처리했는데 Obejective-C 클래스 안에 사용된 Swift 클래스가 에러를 발생시키지 않고 잘 빌드 되었다. 이건 계속해서 확인해보려고 한다.)

## 서버에 사진 업로드 성공!
 
  이미지 픽커 자체는 간단히 추가하였지만 선택하여 가져온 이미지를 서버에 업로드하는 과정에서 몇가지 문제가 있어 해결해야 했습니다.  
  선택하여 가져온 사진이 12장이면 12개의 UIImage가 selectedImages 라는 배열에 저장되어야 하는데,  1장부터 7, 8장까지 랜덤하게 저장되어 당연하게도 그 개수만큼만 서버에 업로드되는 문제였습니다.     온갖 구글링을 통해 문제를 해결 수 있었는데 빨리 해결해야겠다는 압박이 있어 그 과정을 기록, 정리하지 못한 것이 아쉽습니다. (해결한 코드도 추가 예정)
  
## 선택한 이미지를 보여주는 화면  
  
  기존 웹앱 Javascript 단에 선택한 이미지를 보여주는 화면과 관련된 메서드와 화면 소스가 있는데 그 메서드를 Swift로 호출해야하고 호출하여 가져온 화면은 web view에 나타나도록 해야 한다.  
  기존에 작성된 메서드를 사용하려고 해보았는데 단일 이미지를 위한 메서드라 어떤 방식으로 사용하면 좋을 지 아직 확실히 떠오르지 않아 고민중이다.  
  Alamofire upload 부분에서 이미지 이름을 설정하는데 현재는 임의로 생성되도록 해두었는데 yyyyMMdd 형식으로 변환한 이미지 생성일을 이름으로 사용하기 위한 부분을 작성했다.
  

## 사이즈 변경  
  
  자잘하게 추가가 필요한 부분 작성 완료했고, 사진도 잘 올라가는데 속도 이슈가 있어서 확인해보니 이미지 사이즈가 너무 커서 느리게 올라가는 것이었다. 가로 세로 사이즈를 입력해서 줄이는 방법을 사용해서  
  작게 만든 이미지를 업로드 해보았는데 훨씬 빠르게 업로드 되는 것을 확인했다. 내가 필요한건 정확한 수치로 사이즈를 줄이는 것이 아니라 기존 이미지에 같은 가로 / 세로 비율로 사이즈만 작아지는 것이라서  
  그 부분 소스를 작성해보고 있다.

## 12/04  
  
  - 필요한 모든 기능 구현 완료
  - 다음 주 배포 예정이라 모든 메뉴에서 정상적으로 작동하는지 확인해야 한다.  
  - 사진 다중 선택 뿐 아니라 몇가지 추가된 코드도 있어 그 부분도 함께 체크하기. 

 

